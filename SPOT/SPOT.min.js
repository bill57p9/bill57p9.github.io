function SPOT_TRACKER(e){this.id=e.messengerId;this.name=e.messengerName;this.type=e.modelId;this.message=new Array;this.message.push(new SPOT_MESSAGE(e))}function SPOT_MESSAGE(e){this.id=e.id;this.type=e.messageType;this.time=new Date(e.unixTime*1e3);this.battery=e.batteryState;this.latitude=e.latitude;this.longitude=e.longitude}function SPOT_FEED(e){this.id=e;this.description="";this.name="";this.latestMessage=null;this.earliestMessage=null;this.lastUpdated=null;this.tracker=new Array}GT_WGS84.prototype.altitude=null;GT_WGS84.prototype.getRadians=function(){var e=function(e){return e*Math.PI/180};var t={latitude:e(this.latitude),longitude:e(this.longitude)};return t};GT_WGS84.prototype.getDistance=function(e){var t=6378.137;var n=function(e){return e.altitude?t:t+e.altitude};var r=this.getRadians();var i=e.getRadians();var s=Math.cos(r.latitude)*Math.cos(i.latitude)*Math.pow(Math.sin((i.longitude-r.longitude)/2),2)+Math.pow(Math.sin((i.latitude-r.latitude)/2),2);var o=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return o*(n(this)+n(e))/2};GT_WGS84.prototype.getHeading=function(e){var t=this.getRadians();var n=e.getRadians();var r=Math.atan2(Math.sin(n.longitude-t.longitude)*Math.cos(t.latitude),Math.cos(t.latitude)*Math.sin(n.latitude)-Math.sin(t.latitude)*Math.cos(n.latitude)*Math.cos(n.longitude-t.longitude));r*=180/Math.PI;if(r<0)r+=360;return r};SPOT_MESSAGE.prototype=new GT_WGS84;SPOT_MESSAGE.prototype.constructor=SPOT_MESSAGE;var SPOT_FEEDS=new Object;SPOT_FEEDS.feed=new Array;SPOT_FEEDS.json={};SPOT_FEEDS.update=function(e,t,n){if(!t)t=SPOT_FEEDS.feed;for(var r=0;r<t.length;r++){var i="https://api.findmespot.com/spot-main-web/consumer/rest-api/2.0/public/feed/"+t[r].id+"/message.json";if(!t[r].id)i="example1.jsonp";if(!n&&t[r].latestMessage)i+="?startDate="+t[r].latestMessage.toJSON().substr(0,19)+"-0000";if(n&&t[r].earliestMessage)i+="?endDate="+t[r].earliestMessage.toJSON().substr(0,19)+"-0000";console.log(i);t[r].lastUpdated=new Date;J50Npi.getJSON(i,SPOT_FEEDS.json,function(t){var n=t.response.feedMessageResponse;var r=SPOT_FEEDS.getFeed(n.feed.id);r.name=n.feed.name;r.description=n.feed.description;for(var i=n.messages.message.length-1;i>-1;i--){r.addMessage(n.messages.message[i]);var s=new Date(n.messages.message[i].unixTime*1e3);if(!r.earliestMessage||r.earliestMessage>s)r.earliestMessage=s;if(!r.latestMessage||r.latestMessage<s)r.latestMessage=s}r.tracker.sort(SPOT_FEEDS.sortName);for(var i=0;i<r.tracker.length;i++)r.tracker[i].message.sort(function(e,t){return t.time-e.time});if(e)e(r)})}};SPOT_FEEDS.sortName=function(e,t){if(e.name>t.name)return 1;if(e.name<t.name)return-1;return 0};SPOT_FEEDS.getFeed=function(e){for(var t=0;t<SPOT_FEEDS.feed.length;t++)if(SPOT_FEEDS.feed[t].id==e)return SPOT_FEEDS.feed[t];return null};SPOT_FEEDS.addFeed=function(e){if(!e)e=0;SPOT_FEEDS.feed.push(new SPOT_FEED(e));SPOT_FEEDS.feed.sort(SPOT_FEEDS.sortName)};SPOT_FEED.prototype.getTracker=function(e){for(var t=0;t<this.tracker.length;t++){if(this.tracker[t].id==e)return this.tracker[t]}return null};SPOT_FEEDS.getTracker=function(e){for(var t=0;t<this.feed.length;t++){var n=this.feed[t].getTracker(e);if(n)return n}return null};SPOT_FEED.prototype.addMessage=function(e){var t=new SPOT_MESSAGE(e);var n=this.getTracker(e.messengerId);if(!n)this.tracker.push(new SPOT_TRACKER(e));else{for(var r=0;r<n.message.length;r++)if(n.message[r].id==t.id)return false;n.message.unshift(t)}}
